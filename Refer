import xml.etree.ElementTree as ET
import os

def parse_changesets(file_path):
    changesets = []
    try:
        tree = ET.parse(file_path)
        root = tree.getroot()
        namespace = '{http://www.liquibase.org/xml/ns/dbchangelog}'

        for elem in root.findall(f'{namespace}include'):
            included_file = elem.attrib.get('file')
            if included_file:
                included_file_path = os.path.join(os.path.dirname(file_path), included_file)
                changesets.extend(parse_changesets(included_file_path))
        
        for changeset in root.findall(f'{namespace}changeset'):
            changeset_id = changeset.attrib.get('id')
            author = changeset.attrib.get('author')
            changesets.append((file_path, changeset_id, author))

    except ET.ParseError as e:
        print(f"Error parsing XML file {file_path}: {e}")

    return changesets

def log_changesets(changesets):
    with open('liquibase_changeset_log.txt', 'a') as log_file:
        for file_path, changeset_id, author in changesets:
            log_file.write(f'File: {file_path}, ID: {changeset_id}, Author: {author}\n')
